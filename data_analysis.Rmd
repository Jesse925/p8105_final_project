---
title: "Data Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

First to read data from the website. It may take a minute.

```{r}
drug_df = 
  read_csv("./data/Accidental_Drug_Related_Deaths_2012-2018.csv") %>%
  janitor::clean_names() %>% 
  mutate(
    date = as.character(date)
  ) %>% 
  separate(date, into = c("month", "day", "year"), sep = "/") %>% 
  mutate(
    year = unlist(strsplit(year, " "))[1],
    year = ifelse(is.na(month), NA, as.numeric(year)),
    day = as.numeric(day),
    month = factor(month.name[as.numeric(month)], levels = month.name),
    race = as.factor(race),
    sex = as.factor(sex)
  ) %>% 
  separate(injury_city_geo, into = c("injury_city", "injury_geo"), sep = "CT") %>% 
  separate(injury_geo, into = c("inj_longitude", "inj_latitude"), sep = ",") %>% 
  mutate(
    inj_longitude = as.numeric(str_remove(inj_longitude, "\\(")),
    inj_latitude = as.numeric(str_remove(inj_latitude, "\\)")),
    injury_city = str_remove(injury_city, "\\,")
  ) %>% 
  select(-date_type) %>% 
  pivot_longer(
    heroin:any_opioid,
    names_to = "drug_name",
    values_to = "drug_use") %>% 
  drop_na(drug_use)
```

